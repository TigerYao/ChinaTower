{"version":3,"file":"index.js","sources":["../src/constants/events.js","../src/constants/actions.js","../src/createMessageHelper.js"],"sourcesContent":["export const DOM = {\n  PLAY: 'event/dom/play',\n  PLAYING: 'event/dom/playing',\n  PAUSE: 'event/dom/pause',\n  ENDED: 'event/dom/ended',\n  TIMEUPDATE: 'event/dom/timeupdate',\n  ERROR: 'event/dom/error',\n  WAITING: 'event/dom/waiting',\n}\n\nexport const PLAYER = {\n  QUALITY_CHANGE: 'event/player/quality-change',\n  REQUEST_PLAY: 'event/player/request-play',\n  PLAY_REJECTED: 'event/player/play-rejected',\n  REQUEST_PAUSE: 'event/player/request-pause',\n  PLAY_COUNT: 'event/player/play-count',\n  PLAY_FAILED: 'event/player/play-failed',\n  ENTER_FULLSCREEN: 'event/player/enter-fullscreen',\n  EXIT_FULLSCREEN: 'event/player/exit-fullscreen',\n}\n","export const PLAYER = {\n  PLAY: 'action/player/play',\n  PAUSE: 'action/player/pause',\n  SET_VOLUME: 'action/player/set-volume',\n  ENTER_FULLSCREEN: 'action/player/enter-fullscreen',\n  EXIT_FULLSCREEN: 'action/player/exit-fullscreen',\n}\n","const LIB_ID = 'griffith'\n\n/**\n * 创建一个消息管理器\n * @param id 唯一 id，传出消息会带着这个 id\n * @param targetOrigin 对应窗口的域名，不传或者传 * 表示不限制\n * @param validateId 是否验证传入消息的 id 和自身 id 相同\n */\nfunction createMessageHelper(id, targetOrigin = '*', validateId) {\n  function subscribeMessage(handler) {\n    function realHandler(event) {\n      // 限制消息来源 @see https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage#The_dispatched_event\n      const origin = event.origin || event.originalEvent.origin\n      const originIsValidated = targetOrigin === '*' || targetOrigin === origin\n      const {from, id: incomingId, payload} = event.data || {}\n      const idIsValidated = !validateId || id === incomingId\n      if (originIsValidated && from === LIB_ID && idIsValidated && payload) {\n        const {messageName, data} = payload\n        if (messageName) {\n          handler(messageName, data, event.source)\n        }\n      }\n    }\n\n    window.addEventListener('message', realHandler)\n\n    return {\n      unsubscribe: () => window.removeEventListener('message', realHandler),\n    }\n  }\n\n  function dispatchMessage(targetWindow, messageName, data) {\n    if (targetWindow && targetWindow.postMessage) {\n      targetWindow.postMessage(\n        {from: LIB_ID, id, payload: {messageName, data}},\n        targetOrigin || '*'\n      )\n    }\n  }\n\n  return {\n    subscribeMessage,\n    dispatchMessage,\n  }\n}\n\nexport default createMessageHelper\n"],"names":["DOM","PLAY","PLAYING","PAUSE","ENDED","TIMEUPDATE","ERROR","WAITING","PLAYER","QUALITY_CHANGE","REQUEST_PLAY","PLAY_REJECTED","REQUEST_PAUSE","PLAY_COUNT","PLAY_FAILED","ENTER_FULLSCREEN","EXIT_FULLSCREEN","SET_VOLUME","LIB_ID","createMessageHelper","id","targetOrigin","validateId","subscribeMessage","handler","realHandler","event","origin","originalEvent","originIsValidated","from","incomingId","payload","data","idIsValidated","messageName","source","window","addEventListener","unsubscribe","removeEventListener","dispatchMessage","targetWindow","postMessage"],"mappings":";;;;AAAO,MAAMA,GAAG,GAAG;EACjBC,IAAI,EAAE,gBADW;EAEjBC,OAAO,EAAE,mBAFQ;EAGjBC,KAAK,EAAE,iBAHU;EAIjBC,KAAK,EAAE,iBAJU;EAKjBC,UAAU,EAAE,sBALK;EAMjBC,KAAK,EAAE,iBANU;EAOjBC,OAAO,EAAE;CAPJ;AAUP,AAAO,MAAMC,MAAM,GAAG;EACpBC,cAAc,EAAE,6BADI;EAEpBC,YAAY,EAAE,2BAFM;EAGpBC,aAAa,EAAE,4BAHK;EAIpBC,aAAa,EAAE,4BAJK;EAKpBC,UAAU,EAAE,yBALQ;EAMpBC,WAAW,EAAE,0BANO;EAOpBC,gBAAgB,EAAE,+BAPE;EAQpBC,eAAe,EAAE;CARZ;;;;;;;ACVA,MAAMR,QAAM,GAAG;EACpBP,IAAI,EAAE,oBADc;EAEpBE,KAAK,EAAE,qBAFa;EAGpBc,UAAU,EAAE,0BAHQ;EAIpBF,gBAAgB,EAAE,gCAJE;EAKpBC,eAAe,EAAE;CALZ;;;;;;ACAP,MAAME,MAAM,GAAG,UAAf;;;;;;;;AAQA,SAASC,mBAAT,CAA6BC,EAA7B,EAAiCC,YAAY,GAAG,GAAhD,EAAqDC,UAArD,EAAiE;WACtDC,gBAAT,CAA0BC,OAA1B,EAAmC;aACxBC,WAAT,CAAqBC,KAArB,EAA4B;;YAEpBC,MAAM,GAAGD,KAAK,CAACC,MAAN,IAAgBD,KAAK,CAACE,aAAN,CAAoBD,MAAnD;YACME,iBAAiB,GAAGR,YAAY,KAAK,GAAjB,IAAwBA,YAAY,KAAKM,MAAnE;YACM;QAACG,IAAD;QAAOV,EAAE,EAAEW,UAAX;QAAuBC;UAAWN,KAAK,CAACO,IAAN,IAAc,EAAtD;YACMC,aAAa,GAAG,CAACZ,UAAD,IAAeF,EAAE,KAAKW,UAA5C;;UACIF,iBAAiB,IAAIC,IAAI,KAAKZ,MAA9B,IAAwCgB,aAAxC,IAAyDF,OAA7D,EAAsE;cAC9D;UAACG,WAAD;UAAcF;YAAQD,OAA5B;;YACIG,WAAJ,EAAiB;UACfX,OAAO,CAACW,WAAD,EAAcF,IAAd,EAAoBP,KAAK,CAACU,MAA1B,CAAP;;;;;IAKNC,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmCb,WAAnC;WAEO;MACLc,WAAW,EAAE,MAAMF,MAAM,CAACG,mBAAP,CAA2B,SAA3B,EAAsCf,WAAtC;KADrB;;;WAKOgB,eAAT,CAAyBC,YAAzB,EAAuCP,WAAvC,EAAoDF,IAApD,EAA0D;QACpDS,YAAY,IAAIA,YAAY,CAACC,WAAjC,EAA8C;MAC5CD,YAAY,CAACC,WAAb,CACE;QAACb,IAAI,EAAEZ,MAAP;QAAeE,EAAf;QAAmBY,OAAO,EAAE;UAACG,WAAD;UAAcF;;OAD5C,EAEEZ,YAAY,IAAI,GAFlB;;;;SAOG;IACLE,gBADK;IAELkB;GAFF;;;;;;;"}