{"version":3,"file":"index.js","sources":["../src/utils/createMasterM3U8.js","../src/utils/getMasterM3U8Blob.js","../src/Video.js","../src/index.js"],"sourcesContent":["export default function createMasterM3U8(list) {\n  const result = []\n  result.push('#EXTM3U')\n\n  list.forEach(item => {\n    const meta = {\n      'PROGRAM-ID': '1',\n      BANDWIDTH: String(item.bandwidth),\n    }\n    if (item.resolution) {\n      const {width, height} = item.resolution\n      meta.RESOLUTION = `${width}x${height}`\n    }\n    result.push(\n      `#EXT-X-STREAM-INF:${Object.entries(meta)\n        .map(([key, value]) => `${key}=${value}`)\n        .join(',')}`\n    )\n\n    result.push(item.source)\n  })\n\n  return result.join('\\n')\n}\n","import createMasterM3U8 from './createMasterM3U8'\n\nexport default sources => {\n  const list = sources.map(item => ({\n    source: item.source,\n    bandwidth: item.bitrate * 1024,\n    resolution: {\n      width: item.width,\n      height: item.height,\n    },\n  }))\n\n  return new Blob([createMasterM3U8(list)], {\n    type: 'application/vnd.apple.mpegURL',\n  })\n}\n","import React, {Component} from 'react'\nimport Hls from 'hls.js/dist/hls.light.min'\nimport {getMasterM3U8Blob} from './utils'\n\nexport default class Video extends Component {\n  hasLoadStarted = false\n\n  componentDidMount() {\n    this.hls = new Hls({autoStartLoad: false})\n    this.hls.attachMedia(this.video)\n    const {sources} = this.props\n    const master = getMasterM3U8Blob(sources)\n    this.src = URL.createObjectURL(master)\n    this.hls.loadSource(this.src)\n  }\n\n  componentDidUpdate(prevProps) {\n    const {currentQuality, sources, paused} = this.props\n    if (currentQuality !== prevProps.currentQuality) {\n      const source = sources.find(source => source.quality === currentQuality)\n      if (source) {\n        const levels = this.hls.levels\n        const level = levels.findIndex(item => item.url.includes(source.source))\n        this.hls.nextLevel = level\n      } else {\n        this.hls.nextLevel = -1\n      }\n    }\n\n    if (!paused && prevProps.paused && !this.hasLoadStarted) {\n      this.hls.startLoad()\n      this.hasLoadStarted = true\n    }\n  }\n\n  componentWillUnmount() {\n    this.hls.destroy()\n    URL.revokeObjectURL(this.src)\n  }\n\n  render() {\n    // eslint-disable-next-line no-unused-vars\n    const {onRef, currentQuality, src, sources, paused, ...props} = this.props\n    return (\n      <video\n        ref={el => {\n          if (onRef) {\n            onRef(el)\n          }\n          this.video = el\n        }}\n        {...props}\n      />\n    )\n  }\n}\n","import VideoComponent from './Video'\n\nexport default {\n  pluginName: 'griffith-hls',\n  VideoComponent,\n  willHandleSrcChange: true,\n}\n"],"names":["createMasterM3U8","list","result","push","forEach","item","meta","BANDWIDTH","String","bandwidth","resolution","width","height","RESOLUTION","Object","entries","map","key","value","join","source","sources","bitrate","Blob","type","Video","Component","componentDidMount","hls","Hls","autoStartLoad","attachMedia","video","props","master","getMasterM3U8Blob","src","URL","createObjectURL","loadSource","componentDidUpdate","prevProps","currentQuality","paused","find","quality","levels","level","findIndex","url","includes","nextLevel","hasLoadStarted","startLoad","componentWillUnmount","destroy","revokeObjectURL","render","onRef","React","el","pluginName","VideoComponent","willHandleSrcChange"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAe,SAASA,gBAAT,CAA0BC,IAA1B,EAAgC;QACvCC,MAAM,GAAG,EAAf;EACAA,MAAM,CAACC,IAAP,CAAY,SAAZ;EAEAF,IAAI,CAACG,OAAL,CAAaC,IAAI,IAAI;UACbC,IAAI,GAAG;oBACG,GADH;MAEXC,SAAS,EAAEC,MAAM,CAACH,IAAI,CAACI,SAAN;KAFnB;;QAIIJ,IAAI,CAACK,UAAT,EAAqB;YACb;QAACC,KAAD;QAAQC;UAAUP,IAAI,CAACK,UAA7B;MACAJ,IAAI,CAACO,UAAL,GAAmB,GAAEF,KAAM,IAAGC,MAAO,EAArC;;;IAEFV,MAAM,CAACC,IAAP,CACG,qBAAoBW,MAAM,CAACC,OAAP,CAAeT,IAAf,EAClBU,GADkB,CACd,CAAC,CAACC,GAAD,EAAMC,KAAN,CAAD,KAAmB,GAAED,GAAI,IAAGC,KAAM,EADpB,EAElBC,IAFkB,CAEb,GAFa,CAER,EAHf;IAMAjB,MAAM,CAACC,IAAP,CAAYE,IAAI,CAACe,MAAjB;GAfF;SAkBOlB,MAAM,CAACiB,IAAP,CAAY,IAAZ,CAAP;;;ACpBF,yBAAeE,OAAO,IAAI;QAClBpB,IAAI,GAAGoB,OAAO,CAACL,GAAR,CAAYX,IAAI,KAAK;IAChCe,MAAM,EAAEf,IAAI,CAACe,MADmB;IAEhCX,SAAS,EAAEJ,IAAI,CAACiB,OAAL,GAAe,IAFM;IAGhCZ,UAAU,EAAE;MACVC,KAAK,EAAEN,IAAI,CAACM,KADF;MAEVC,MAAM,EAAEP,IAAI,CAACO;;GALY,CAAhB,CAAb;SASO,IAAIW,IAAJ,CAAS,CAACvB,gBAAgB,CAACC,IAAD,CAAjB,CAAT,EAAmC;IACxCuB,IAAI,EAAE;GADD,CAAP;CAVF;;ACEe,MAAMC,KAAN,SAAoBC,eAApB,CAA8B;;;;4CAC1B,KAD0B;;;EAG3CC,iBAAiB,GAAG;SACbC,GAAL,GAAW,IAAIC,GAAJ,CAAQ;MAACC,aAAa,EAAE;KAAxB,CAAX;SACKF,GAAL,CAASG,WAAT,CAAqB,KAAKC,KAA1B;UACM;MAACX;QAAW,KAAKY,KAAvB;UACMC,MAAM,GAAGC,iBAAiB,CAACd,OAAD,CAAhC;SACKe,GAAL,GAAWC,GAAG,CAACC,eAAJ,CAAoBJ,MAApB,CAAX;SACKN,GAAL,CAASW,UAAT,CAAoB,KAAKH,GAAzB;;;EAGFI,kBAAkB,CAACC,SAAD,EAAY;UACtB;MAACC,cAAD;MAAiBrB,OAAjB;MAA0BsB;QAAU,KAAKV,KAA/C;;QACIS,cAAc,KAAKD,SAAS,CAACC,cAAjC,EAAiD;YACzCtB,MAAM,GAAGC,OAAO,CAACuB,IAAR,CAAaxB,MAAM,IAAIA,MAAM,CAACyB,OAAP,KAAmBH,cAA1C,CAAf;;UACItB,MAAJ,EAAY;cACJ0B,MAAM,GAAG,KAAKlB,GAAL,CAASkB,MAAxB;cACMC,KAAK,GAAGD,MAAM,CAACE,SAAP,CAAiB3C,IAAI,IAAIA,IAAI,CAAC4C,GAAL,CAASC,QAAT,CAAkB9B,MAAM,CAACA,MAAzB,CAAzB,CAAd;aACKQ,GAAL,CAASuB,SAAT,GAAqBJ,KAArB;OAHF,MAIO;aACAnB,GAAL,CAASuB,SAAT,GAAqB,CAAC,CAAtB;;;;QAIA,CAACR,MAAD,IAAWF,SAAS,CAACE,MAArB,IAA+B,CAAC,KAAKS,cAAzC,EAAyD;WAClDxB,GAAL,CAASyB,SAAT;WACKD,cAAL,GAAsB,IAAtB;;;;EAIJE,oBAAoB,GAAG;SAChB1B,GAAL,CAAS2B,OAAT;IACAlB,GAAG,CAACmB,eAAJ,CAAoB,KAAKpB,GAAzB;;;EAGFqB,MAAM,GAAG;;UAED;MAACC,KAAD;MAAQhB,cAAR;MAAwBN,GAAxB;MAA6Bf,OAA7B;MAAsCsB,MAAtC;SAAiDV;QAAS,KAAKA,KAArE;WAEE0B;MACE,GAAG,EAAEC,EAAE,IAAI;YACLF,KAAJ,EAAW;UACTA,KAAK,CAACE,EAAD,CAAL;;;aAEG5B,KAAL,GAAa4B,EAAb;;OAEE3B,KAPN,EADF;;;;;ACzCJ,YAAe;EACb4B,UAAU,EAAE,cADC;kBAEbC,KAFa;EAGbC,mBAAmB,EAAE;CAHvB;;;;"}